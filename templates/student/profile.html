{% extends "base.html" %}

{% block title %}Profil étudiant{% endblock %}

{% block content %}
<h2>Profil de l'étudiant</h2>
<div class="row">
    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-body text-center">
                {% if student.photo %}
                    <img src="{{ url_for('static', filename='uploads/' + student.photo) }}" 
                         alt="Photo de {{ student.prenom }} {{ student.nom }}" 
                         class="img-fluid rounded mb-3" 
                         style="max-width: 200px;">
                {% else %}
                    <div class="bg-light rounded mb-3" style="width: 200px; height: 200px; margin: 0 auto;">
                        <i class="bi bi-person" style="font-size: 100px; line-height: 200px;"></i>
                    </div>
                {% endif %}
                
                <form action="{{ url_for('student.upload_student_image', student_id=student.id) }}" 
                      method="POST" 
                      enctype="multipart/form-data"
                      class="mt-3">
                    <div class="mb-3">
                        <label for="image" class="form-label">Upload Photo</label>
                        <input type="file" 
                               class="form-control" 
                               id="image"
                               name="image" 
                               accept="image/*" 
                               required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-upload"></i> Upload Photo
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-body">
                <h4>{{ student.nom }} {{ student.prenom }}</h4>
                <p><strong>Matricule:</strong> {{ student.matricule }}</p>
                <p><strong>CIN:</strong> {{ student.cin }}</p>
                <p><strong>Sexe:</strong> {{ student.sexe }}</p>
                <p><strong>Type/Section:</strong> {{ student.type_section }}</p>
                <p><strong>Filière:</strong> {{ student.filiere_name }}</p>
                <p><strong>Année universitaire:</strong> {{ student.annee_universitaire }}</p>
                <p><strong>Email:</strong> {{ student.email }}</p>
                <p><strong>Téléphone:</strong> {{ student.telephone }}</p>
                <p><strong>Nationalité:</strong> {{ student.nationalite }}</p>
                <p><strong>Date de naissance:</strong> {{ student.date_naissance }}</p>
                <p><strong>Chambre actuelle:</strong> 
                    {% if room %}
                        {{ room.room_number }} ({{ room.pavilion }}, {{ room.room_type }}, Capacité: {{ room.capacity }})
                    {% else %}
                        Aucune
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<h4>Historique des chambres</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Année</th>
            <th>Numéro de chambre</th>
            <th>Pavillon</th>
            <th>Type</th>
        </tr>
    </thead>
    <tbody>
        {% for h in history %}
        <tr>
            <td>{{ h.year }}</td>
            <td>{{ h.room.room_number if h.room else '' }}</td>
            <td>{{ h.room.pavilion if h.room else '' }}</td>
            <td>{{ h.room.room_type if h.room else '' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
